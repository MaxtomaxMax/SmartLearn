> 本文档用于记录项目开发过程中**遇到的问题和最终的解决方案**
> 在书写这个文档的时候应该遵循以下格式：
>
> > 日期——直接用输入法输入“日期”即可获得对应格式，如：2024 年 5 月 1 日
> > [产生问题/汇报进度的模块] 例如：毫米波心率测量模块；数据库接口模块
> > [遇到的问题描述/开发进度展示]
> > 汇报人
>
> 此文档最终将用于撰写课程设计的报告，建议用于撰写报告的相关内容在记录开发 Log 的时候按照最终报告的格式进行书写，附上对应的展示图片并做好标题命名，**所有图片存储在文件夹 fig 中**

![SmartLearn](/fig4log/SmartLearn.png)

# 项目进度汇报

## Max

2024 年 5 月 5 日
15 点 18 分
完成小程序最初加载的页面

![loading](/fig4log/fig1.png)

页面路径：software_test\mini_program_test\pages\login\init_loading.vue

15 点 58 分
完成在学习板块的背景渐变设计，详见 software_test\mini_program_test\App.vue 中的 globalStyle 内容

等待蓝牙连接页面完成半成品
页面路径：software_test\mini_program_test\pages\learn\wait4bt.vue

2024 年 5 月 6 日
01 点 14 分
完成 API 对话功能 python 的 demo 演示，初步决定智学对话学习助手的交互形式

2024 年 5 月 7 日
18 点 30 分
完成了前端登录页面简单的跳转逻辑实现

22 点 18 分
完成了数据库用户最基本信息的设计

2024 年 5 月 10 日
17 点 57 分
数据库 API 接口调试基本完成

2024 年 5 月 14 日
17 点 56 分
完成用户注册登录系统的后端开发

2024年5月15日
17点29分
开发AI聊天页面样式

2024年5月18日
完成基本AI聊天页面，剩下细节需要调整

## Jas

2024 年 5 月 5 日前已完成

- 本地毫米波数据处理，
- 学会租云服务器进行 yolo 模型训练、本地摄像头验证功能
- Dlib 功能实现、本地摄像头验证功能

2024 年 5 月 9 日完成

- 毫米波模块静息态、stroop 范式测试
- PPG 和 esp32cam 选型,简单了解 http 协议的数据传输

## Ljh

## Zy

1. 使用 STM32 已实现将串口接收数据进行串口发送功能，功能操作方式（可通过按键控制开始收发等）有待进一步优化，串口接收毫米波输出数据，串口通过蓝牙发送数据，蓝牙还未调试
2. 在微信开发平台已经搭建蓝牙接收调试程序，正在进行调试，调试完毕后将开始学习并进行进行 uni—app 的搭建，微信开发者平台的蓝牙框架适用于 uni-app 只需移植

###

3.完成 uni-app 蓝牙页面的开发，蓝牙连接和学习开始的 button 功能待合并

###

4.完成了 tabBar 的设计，在 tabBar 设计时遇到问题：图片的链接需要使用本地的而非网络 url 格式链接，由 codefun 设计的静态 ui 图片链接均为网络 url、链接，我初步只更改了 tabBar 的几个图片的本地连接，后续有需要再更改其它

5.完成了 user 页面的逻辑跳转和组件功能，有待和数据库进行 api 调用数据交互

# 开发遇到的问题＆解决方案

## 前端开发

2024 年 5 月 7 日
出问题的静态页面总结：

- 页面“书架”的滚动和 tabBar
- 页面“学完”的图标
- 蓝牙连接 Ready 后的问号位置对齐
- 复习的“历史”界面头顶消失

致命问题：
在 codefun 的 view 容器中有 header 标记的都无法编译出来

**解决方案**
问题原因：Header 标识的容器组件错误，导致误删了状态栏以外的元素
解决方案：

1. 在 codefun 平台上更改 header 标识的容器组件
2. 在 figma 上修改对应属性

2024 年 5 月 10 日
发现 codefun 平台上面存储的静态素材的 url 会更新
**解决方案**

- unicloud 平台上云存储静态素材
- 用腾讯云或阿里云等云平台自己搭建云图床

优先尝试第一种解决方案


2024年5月17日
开发问题汇总
- 通过`v-if`, `v-for`, `scroll-view`等方法与组件解决聊天框对话的渲染
- 解决发送后自动滚动到底部的问题，关键在于属性`scroll-into-view`的使用
- 解决了下拉框的样式问题：1）必须确认css样式命名；2）可以通过>>>改动组件深层的样式

  
tips：
- 需要熟练掌握开发者工具用于调试
- 深刻理解flex布局，不会就查官方文档或官方教程

2024年5月18日
通过透明度调整解决了信息框与输入框显示的问题

## 后端开发

2024 年 5 月 9 日**毫米波问题总结**：

- 在测试静息态和压力态（心算范式）时的 HRV 值差别不大，难以区分
- 串口数据和实际心率图相差较大，导致 RR 间隔抖动大，基于此计算出来的 HRV 值误差也非常大

**解决方案**
将毫米波模块改为 PPG 模块（光电容积脉搏波描记法）

2024 年 5 月 10 日
数据库表结构开发有点异常
**解决方案**
补充基础知识，详细了解工作原理

2024 年 5 月 14 日
02 点 23 分
实现用户注册密码加密存储的时候始终存储不上，为空字符

**解决方案**
经过排查发现是 this.hashPassword 变量收不到值，最终排查出错误之后结合 GPT 问答发现是异步调用问题

注意：

- 异步调用要么在 Promise 对象返回后.then()里面调用后面的代码
- 要么就 async 对应的代码之后老老实实 await

16 点 11 分
校验邮箱唯一性的时候出现问题，始终无法正常搜索数据库，代码如下：

```js
// 用于检测是否字段是否在数据库中唯一
"use strict";
const db = uniCloud.database();
exports.main = async (event, context) => {
  let { key, value } = event;

  return await db
    .collection("SmartLearn_user")
    .where({
      key: value,
    })
    .get();
};
```

**解决方案**：
不能再对象{}内字面使用`key:value`，这样会`key`被视为字符串字面量而不是变量，此时实际上在查询`"key"`而不是`key`变量的值

修改后代码：

```js
// 用于检测是否字段是否在数据库中唯一
"use strict";
const db = uniCloud.database();
exports.main = async (event, context) => {
  let { key, value } = event;
  let key_value = {};
  key_value[key] = value; // 直接写key:value

  return await db.collection("SmartLearn_user").where(key_value).get();
};
```

# 前端 UI 修改需求

（未打勾表示未实现）

<!-- - [ ] 登录页面添加微信登录页面入口
- [ ] 微信一键登录页面 -->

- [ ] 邮箱登录输入密码的文本输入框加一个小眼睛（显示密码的）（主要是需要这个图标）
- [ ] 5 月 7 日提出的若干问题
- [ ] 注册成功的地方添加一个绑定微信的按钮，引入绑定微信的页面
- [ ] 绑定微信的页面
- [ ] 绑定微信成功页面（跟注册成功相似但做一丢丢区分）
- [ ] 添加一个能够让用户更改用户名的地方（新页面 or 图标）,后端默认用邮箱注册，用户名随机生成
- [ ] 考虑在用户注册的部分添加邮箱验证功能（多一个输入框填写验证码）

# 协同开发沟通

> 用于对协同开发过程中的留言，每次开发前都应该查看！！避免重复开发

## 给 Max 的留言

## 给 Jas 的留言

## 给 zy 的留言

2024 年 5 月 7 日 18 点 32 分
我已经完成了登录页面 👇 的跳转逻辑了，不需要重复开发
![alt text](/fig4log/fig2.png)

## 给 ljh 的留言
